const elementProperties=["innerText","textContent","className","nodeValue","style","innerHTML","outerHTML","dataset","contentEditable","draggable","checked","disabled","required","value","alt","role","id"];function collect(e){const t=[];return function e(n){1!=n.nodeType&&3!=n.nodeType||t.push(n),n.childNodes&&n.childNodes.forEach((t=>e(t)))}(e),[...new Set(t)]}function destroy(e){if("string"!=typeof e)for(let t in e){let n=e[t];n&&isObj(n)?destroy(n):n instanceof Map?n.forEach(((e,t)=>{destroy(e),n.delete(t)})):n instanceof Set?(n.forEach((e=>{destroy(e)})),n.clear()):Array.isArray(n)&&n.forEach((e=>{destroy(e)})),delete e[t],n=null}}const hooksGen=new Proxy({},{get:(e,t)=>function(e){let n=RenderContext,o=n[n.length-1];n.length?(o[t]&&console.warn(`HookSet-${t.toUpperCase()} Warn:\n${t} hook already set!`),o.hooks[t].add(e)):console.warn(`HookSet-${t.toUpperCase()} Warn:\nThis hook must be in a component scope!`),e=null,n=null,o=null}}),{onConnect:onConnect,onRemove:onRemove}=hooksGen;function HTML(e){return document.createRange().createContextualFragment(e)}const $Components=(()=>{const e=new Map;return{get(t){if(e.has(t.toLowerCase()))return e.get(t.toLowerCase());console.warn("Component<"+t+"> is not defined!")},set(t,n){"string"==typeof t?"function"==typeof n?t.includes(" ")?console.error("Component names should not contain spaces."):e.set(t.toLowerCase(),n):console.error("Value must be a component-function."):console.error("Key must be a string.")},render(t,n){if(e.has(t))return Render((()=>e.get(t)(n)))},has:t=>e.has(t)}})();function Component(e,t){return"string"==typeof e&&"function"==typeof t?($Components.set(e,t),(...t)=>$Components.render(e,...t)):"string"==typeof e&&void 0===t?(...t)=>$Components.render(e,...t):"function"==typeof e?(...t)=>Render((()=>e(...t))):void 0}function nM(e){let t=e,n=t.split("/>").length-1,o=0;for(;n>o;){let e=t.search("/>")-1,n=0,r="";for(;e-n>=-1;){if("<"==t.charAt(e-n)){let l=(r=r.split("").reverse().join("")).split(" ")[0],s=`<${l} ${r.replace(l,"")||""}></${l}>`;t=t.slice(0,e-n)+s+t.slice(e+3,t.length),o++,e="",n=0,r=""}else r+=t.charAt(e-n);n++}}return t}function parseText(e){const t=e.split(key),n=[];return t.forEach(((e,o)=>{n.push(e),o<t.length-1&&n.push(key)})),n}function process(e){if(1==e.nodeType){let t=e.tagName.toLowerCase(),n={};for(let t of e.attributes)n[t.name]=t.value;let o=[];return[...e.childNodes].forEach((e=>{3==e.nodeType?e.nodeValue.includes(key)?o=[...o,...parseText(e.nodeValue)]:o.push(e.nodeValue):1==e.nodeType&&o.push(process(e))})),createElement(t,n,...o)}return null}function processARGS(e,t){for(const n in e.props)t.length>0&&e.props[n]==key&&(e.props[n]=t.shift());return e.children.forEach(((n,o)=>{t.length>0&&("string"==typeof n&&n==key?e.children[o]=t.shift():"object"==typeof n&&processARGS(n,t))})),e}let memoized={templates:new Map,named:new Map,auto:!0};function htmlTextParser(e){let t;return memoized.named.has(e)?t=memoized.named.get(e):(t=e.join(key).replaceAll("<>","<fragment>").replaceAll("</>","</fragment>"),t.includes("/>")&&(t=nM(t)),memoized.named.set(e,t)),t}let key="#$_CHNXKEY_$#";function html(e,...t){let n,o,r=htmlTextParser(e);return memoized.templates.has(r)?o=JSON.parse(JSON.stringify(memoized.templates.get(r))):(n=HTML(r).firstElementChild,o=process(n),memoized.templates.set(r,JSON.parse(JSON.stringify(o)))),o=processARGS(o,t),e=null,n=null,t=null,Element_Render(o)}function createElement(e,...t){let n;return t.forEach(((e,o)=>{isObj(e)&&!e._&&(n=t.splice(o,1)[0])})),{tag:e,props:n,children:t,_:1}}html.plain=function(e){return HTML(e).firstElementChild};const Elements=new Proxy({},{get:(e,t)=>(...e)=>{let n=t.toLowerCase();return"f"==n||"frag"==n||"fragment"==n?n="fragment":"text"!=n&&"textnode"!=n&&"t"!=n||(n="text"),createElement(n,...e)}});function isObj(e){return e?Object.getPrototypeOf(e)==Object.prototype:0}function Mount(e,t,...n){let o,r,l;"string"==typeof e?o=document.querySelector(e):e instanceof Node?o=e:l+="Target must be a HTMLELEMENT - ","function"==typeof t?r=Render((()=>t(...n))):t instanceof Node?r=t:l+="Output must be a HTMLELEMENT - ",l?console.error("Mounting Error:\n"+l):o.appendChild(r)}function ID(e,t){let n=t?_INCREASE_:_DECREASE_;e&&e[n]&&e[n].forEach((t=>t.call(e)))}function $CA(e,t,n){e.getAttribute(t)!==n&&e.setAttribute(t,n)}function $CV(e,t,n){e[t]!==n&&(e[t]=n)}let StateContext=[];function createState(e){let t=new Set,n={initial:e,get:()=>(StateContext.length&&StateContext[StateContext.length-1].add(t),n.initial),set(e){let o=n.initial,r=o!==e;return n.initial=e,r&&t.forEach((e=>e({before:o,current:n.initial}))),e}};function o(e){return arguments.length?n.set("function"==typeof e?e(n.initial):e):(e=null,n?n.get():void 0)}return o.kill=function(){destroy({set:t,data:n}),t=null,n=null,o.kill=null,o=null},RenderContext.length&&RenderContext[RenderContext.length-1].states.add(o),o}function createReducer(e,t){let n,o=createState(e);function r(...e){if(!arguments.length)return o();o(t(o(),...e))}return r.kill=()=>{n=null,o=null,r=null},n=o.kill,o.kill=()=>{n(),r.kill()},r}function createComputed(e){let t=createState(1),n=watch((()=>{t(e())})),o=t.kill;return t.kill=()=>{n.kill(),o(),o=null,t=null,n=null,e=null},t}function watch(e,t){let n;StateContext.push(new Set);let o={append(){l.forEach((e=>{e.add(n)}))},remove(){l.forEach((e=>{e.delete(n)}))},kill(){for(o.remove();l.length;)l.pop();l=null,destroy(o),e.kill&&e.kill(),e=null,n=null,o=null},trigger(){n()}};Object.assign(o,t),n=()=>e(o);let r=n(),l=StateContext.pop();return 0==l.size?(o.kill(),o=null,r):(r=null,o.append(),o)}function untrack(e){StateContext.push(new Set);let t=e();return StateContext.pop(),t}function Watch(e){"function"!=typeof e?console.error("Watchers Must Be A Function!"):RenderContext.length?RenderContext[RenderContext.length-1].hooks.Effects.add(e):console.error("Watchers Must Be In A Component  'use:watch' !")}let RenderContext=[];const _INCREASE_=Symbol(),_DECREASE_=Symbol(),_INDEX_=Symbol(),_MEMO_=Symbol();let L=()=>RenderContext[RenderContext.length-1],index=0;function newRender(e){let t={_memo:e,index:++index,eventlisteners:new Map,states:new Set,page:null,activeEffects:new Set,hooks:{onConnect:new Set,onRemove:new Set,Effects:new Set},children:new Set,mountedLength:0,increase:function(){if(t.eventlisteners.has(this)){t.eventlisteners.get(this).forEach(((e,t)=>{this.addEventListener(t,e)}))}0==t.mountedLength&&t.append(),t.mountedLength++},decrease:function(){if(t.mountedLength--,t.eventlisteners.has(this)){t.eventlisteners.get(this).forEach(((e,t)=>{this.removeEventListener(t,e)}))}0==t.mountedLength&&t.remove()},append(){t.hooks.onConnect.forEach((e=>e(t.page))),0==t.activeEffects.size&&t.activeEffects.size<t.hooks.Effects.size?t.hooks.Effects.forEach((e=>{t.activeEffects.add(watch(e,{element:t.page}))})):t.activeEffects.forEach((e=>{e.append(),e.trigger()}))},remove(){t.hooks.onRemove.forEach((e=>e(t.page))),t.activeEffects.forEach((e=>{e.remove()})),!t._memo&&t.delete()},delete(){t.activeEffects.forEach((e=>e.kill())),t.states.forEach((e=>{e.kill&&e.kill()})),t.children.forEach((e=>{e[_INDEX_].delete(t.index),e[_INCREASE_].delete(t.increase),e[_DECREASE_].delete(t.decrease),e[_MEMO_].delete(t.memo),e[_INDEX_].size+e[_INCREASE_].size+e[_DECREASE_].size+e[_MEMO_].size==0&&(delete e[_INDEX_],delete e[_INCREASE_],delete e[_DECREASE_],delete e[_MEMO_],e.remove&&e.remove(),e=null)})),t.children.clear(),destroy(t),t=null},memo(e){if(void 0===e)return t._memo;t._memo=Boolean(e)}};t.memo.index=t.index,RenderContext.push(t)}function declareCounter(e){let t=RenderContext[RenderContext.length-1];return e[_INCREASE_]||(e[_INCREASE_]=new Set,e[_DECREASE_]=new Set,e[_INDEX_]=new Set,e[_MEMO_]=new Set),e[_INCREASE_].add(t.increase),e[_DECREASE_].add(t.decrease),e[_INDEX_].add(t.index),e[_MEMO_].add(t.memo),t.children.add(e),t=null,e}function Element_Render(e){let t,n=L();if("string"==typeof e||"number"==typeof e)return declareCounter(new Text(e));if("function"==typeof e){let t=new Text;return n.hooks.Effects.add((()=>{let n=e();t.nodeValue!==n.toString()&&(t.nodeValue=n)})),declareCounter(t)}if(e instanceof Node)return declareCounter(e);if(Array.isArray(e))return Render(e);if("fragment"==e.tag)t=new DocumentFragment;else{if($Components.has(e.tag))return declareCounter($Components.render(e.tag,{props:e.props,slot:Render(e.children),children:e.children}));if("text"==e.tag)return t=new Text,"function"==typeof e.children[0]?n.hooks.Effects.add((function(){$CV(t,"nodeValue",e.children[0]().toString())})):t.nodeValue=e.children[0],declareCounter(t);t=document.createElement(e.tag),declareCounter(t)}return e.props&&Object.keys(e.props).forEach((o=>{if("function"==typeof e.props[o])if(o.startsWith("on")){let s=o.toLowerCase().substring(2);n.eventlisteners.has(t)||n.eventlisteners.set(t,new Map),n.eventlisteners.get(t).set(s,(function(){e.props[o].call(this)})),s=null}else if("use"==o||"sync"==o){function r(){e.props[o].call(t)}"use"==o?(r.call(t),r=null):n.hooks.Effects.add(r)}else{let i=elementProperties.includes(o)?$CV:$CA;function l(){i(t,o,e.props[o]().toString())}l.kill=()=>{i=null,l=null},n.hooks.Effects.add(l)}else elementProperties.includes(o)?t[o]=e.props[o]:t.setAttribute(o,e.props[o])})),Array.isArray(e.children)?e.children.forEach((e=>{t.appendChild(Element_Render(e))})):e.children&&t.appendChild(Element_Render(e.children)),t}function Fragment_Render(e){return{tag:"fragment",props:void 0,children:e}}function Render(e,t=!1){let n=L()?L()._memo:null;newRender(t??n);let o,r="function"==typeof e?e():e;return Array.isArray(r)&&(r=Fragment_Render(r)),o=r instanceof Node?r:Element_Render(r),RenderContext.pop().page=o,o}function Memo(e){return Render(e,!0)}const o=new MutationObserver((e=>{e.forEach((e=>{"childList"==e.type&&(e.removedNodes.forEach((e=>{collect(e).forEach((e=>ID(e)))})),e.addedNodes.forEach((e=>{collect(e).forEach((e=>ID(e,1)))})))}))}));o.observe(document,{childList:!0,subtree:!0});export{html,Component,onConnect,onRemove,Elements,createComputed,createReducer,createState,untrack,watch,Watch,Render,Memo,Mount};
