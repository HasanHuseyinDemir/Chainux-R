function collect(e){let t=[];return!function e(n){(1==n.nodeType||3==n.nodeType)&&t.push(n),n.childNodes&&n.childNodes.forEach(t=>e(t))}(e),[...new Set(t)]}function destroy(e){if("string"!=typeof e)for(let t in e){let n=e[t];n&&isObj(n)?destroy(n):n instanceof Map?n.forEach((e,t)=>{destroy(e),n.delete(t)}):n instanceof Set?(n.forEach(e=>{destroy(e)}),n.clear()):Array.isArray(n)&&n.forEach(e=>{destroy(e)}),delete e[t],n=null}}let hooksGen=new Proxy({},{get:(e,t)=>function(e){let n=RenderContext,r=n[n.length-1];n.length?(r[t]&&console.warn(`HookSet-${t.toUpperCase()} Warn:
${t} hook already set!`),r.hooks[t].add(e)):console.warn(`HookSet-${t.toUpperCase()} Warn:
This hook must be in a component scope!`),e=null,n=null,r=null}}),{onConnect:e,onRemove:t}=hooksGen;function HTML(e){return document.createRange().createContextualFragment(e)}let $Components=(()=>{let e=new Map;return{get(t){if(e.has(t.toLowerCase()))return e.get(t.toLowerCase());console.warn("Component<"+t+"> is not defined!")},set(t,n){if("string"!=typeof t){console.error("Key must be a string.");return}if("function"!=typeof n){console.error("Value must be a component-function.");return}if(t.includes(" ")){console.error("Component names should not contain spaces.");return}e.set(t.toLowerCase(),n)},render(t,n){if(e.has(t))return Render(()=>e.get(t)(n))},has:t=>e.has(t)}})();function Component(e,t){return"string"==typeof e&&"function"==typeof t?($Components.set(e,t),(...t)=>$Components.render(e,...t)):"string"==typeof e&&void 0===t?(...t)=>$Components.render(e,...t):"function"==typeof e?(...t)=>Render(()=>e(...t)):void 0}function nM(e){let t=e,n=t.split("/>").length-1,r=0;for(;n>r;){let l=t.search("/>")-1,i=0,s="";for(;l-i>=-1;){if("<"==t.charAt(l-i)){let a=(s=s.split("").reverse().join("")).split(" ")[0],c=`<${a} ${s.replace(a,"")||""}></${a}>`;t=t.slice(0,l-i)+c+t.slice(l+3,t.length),r++,l="",i=0,s=""}else s+=t.charAt(l-i);i++}}return t}function parseText(e){let t=e.split(key),n=[];return t.forEach((e,r)=>{n.push(e),r<t.length-1&&n.push(key)}),n}function process(e){if(1==e.nodeType){let t=e.tagName.toLowerCase(),n={};for(let r of e.attributes)n[r.name]=r.value;let l=[];return[...e.childNodes].forEach(e=>{3==e.nodeType?e.nodeValue.includes(key)?l=[...l,...parseText(e.nodeValue)]:l.push(e.nodeValue):1==e.nodeType&&l.push(process(e))}),createElement(t,n,...l)}return null}function processARGS(e,t){for(let n in e.props)t.length>0&&e.props[n]==key&&(e.props[n]=t.shift());return e.children.forEach((n,r)=>{t.length>0&&("string"==typeof n&&n==key?e.children[r]=t.shift():"object"==typeof n&&processARGS(n,t))}),e}let memoized={templates:new Map,named:new Map,auto:!0};function htmlTextParser(e){let t;return memoized.named.has(e)?t=memoized.named.get(e):((t=e.join(key).replaceAll("<>","<fragment>").replaceAll("</>","</fragment>")).includes("/>")&&(t=nM(t)),memoized.named.set(e,t)),t}let key="#$_CHNXKEY_$#";function html(e,...t){let n,r,l=htmlTextParser(e);return memoized.templates.has(l)?r=JSON.parse(JSON.stringify(memoized.templates.get(l))):(r=process(n=HTML(l).firstElementChild),memoized.templates.set(l,JSON.parse(JSON.stringify(r)))),r=processARGS(r,t),e=null,n=null,t=null,Element_Render(r)}function createElement(e,...t){let n;return t.forEach((e,r)=>{isObj(e)&&!e._&&(n=t.splice(r,1)[0])}),{tag:e,props:n,children:t,_:1}}html.plain=function(e){return HTML(e).firstElementChild};let Elements=new Proxy({},{get:(e,t)=>(...e)=>{let n=t.toLowerCase();return"f"==n||"frag"==n||"fragment"==n?n="fragment":("text"==n||"textnode"==n||"t"==n)&&(n="text"),createElement(n,...e)}});function isObj(e){return e?Object.getPrototypeOf(e)==Object.prototype:0}function Mount(e,t,...n){let r,l,i;"string"==typeof e?r=document.querySelector(e):e instanceof Node?r=e:i+="Target must be a HTMLELEMENT - ","function"==typeof t?l=Render(()=>t(...n)):t instanceof Node?l=t:i+="Output must be a HTMLELEMENT - ",i?console.error("Mounting Error:\n"+i):r.appendChild(l)}function ID(e,t){let n=t?$I:$D;e&&e[n]&&e[n].forEach(t=>t.call(e))}function $CA(e,t,n){e.getAttribute(t)!==n&&e.setAttribute(t,n)}function $CV(e,t,n){e[t]!==n&&(e[t]=n)}let StateContext=[];function createState(e){let t=new Set,n={initial:e,get:()=>(StateContext.length&&StateContext[StateContext.length-1].add(t),n.initial),set(e){let r=n.initial;return n.initial=e,r!==e&&t.forEach(e=>e({before:r,current:n.initial})),e}};function r(e){return arguments.length?n.set("function"==typeof e?e(n.initial):e):(e=null,n)?n.get():void 0}return r.kill=function(){destroy({set:t,data:n}),t=null,n=null,r.kill=null,r=null},RenderContext.length&&RenderContext[RenderContext.length-1].states.add(r),r}function createReducer(e,t){let n=createState(e),r;function l(...e){if(!arguments.length)return n();n(t(n(),...e))}return l.kill=()=>{r=null,n=null,l=null},r=n.kill,n.kill=()=>{r(),l.kill()},l}function createComputed(e){let t=createState(1),n=watch(()=>{t(e())}),r=t.kill;return t.kill=()=>{n.kill(),r(),r=null,t=null,n=null,e=null},t}function watch(e,t){StateContext.push(new Set);let n,r={append(){i.forEach(e=>{e.add(n)})},remove(){i.forEach(e=>{e.delete(n)})},kill(){for(r.remove();i.length;)i.pop();i=null,destroy(r),e.kill&&e.kill(),e=null,n=null,r=null},trigger(){n()}};Object.assign(r,t);let l=(n=()=>e(r))(),i=StateContext.pop();return 0==i.size?(r.kill(),r=null,l):(l=null,r.append(),r)}function untrack(e){StateContext.push(new Set);let t=e();return StateContext.pop(),t}function Watch(e){"function"!=typeof e?console.error("Watchers Must Be A Function!"):RenderContext.length?RenderContext[RenderContext.length-1].hooks.Effects.add(e):console.error("Watchers Must Be In A Component  'use:watch' !")}let RenderContext=[],$I=Symbol(),$D=Symbol(),IN=Symbol(),$M=Symbol(),L=()=>RenderContext[RenderContext.length-1],index=0;function newRender(e){let t={_memo:e,index:++index,eventlisteners:new Map,states:new Set,page:null,activeEffects:new Set,hooks:{onConnect:new Set,onRemove:new Set,Effects:new Set},children:new Set,mountedLength:0,increase:function(){t.eventlisteners.has(this)&&t.eventlisteners.get(this).forEach((e,t)=>{this.addEventListener(t,e)}),0==t.mountedLength&&t.append(),t.mountedLength++},decrease:function(){t.mountedLength--,t.eventlisteners.has(this)&&t.eventlisteners.get(this).forEach((e,t)=>{this.removeEventListener(t,e)}),0==t.mountedLength&&t.remove()},append(){t.hooks.onConnect.forEach(e=>e(t.page)),0==t.activeEffects.size&&t.activeEffects.size<t.hooks.Effects.size?t.hooks.Effects.forEach(e=>{t.activeEffects.add(watch(e,{element:t.page}))}):t.activeEffects.forEach(e=>{e.append(),e.trigger()})},remove(){t.hooks.onRemove.forEach(e=>e(t.page)),t.activeEffects.forEach(e=>{e.remove()}),t._memo||t.delete()},delete(){t.activeEffects.forEach(e=>e.kill()),t.states.forEach(e=>{e.kill&&e.kill()}),t.children.forEach(e=>{e[IN].delete(t.index),e[$I].delete(t.increase),e[$D].delete(t.decrease),e[$M].delete(t.memo),e[IN].size+e[$I].size+e[$D].size+e[$M].size==0&&(delete e[IN],delete e[$I],delete e[$D],delete e[$M],e.remove&&e.remove(),e=null)}),t.children.clear(),destroy(t),t=null},memo(e){if(void 0===e)return t._memo;t._memo=Boolean(e)}};t.memo.index=t.index,RenderContext.push(t)}function declareCounter(e){let t=RenderContext[RenderContext.length-1];return e[$I]||(e[$I]=new Set,e[$D]=new Set,e[IN]=new Set,e[$M]=new Set),e[$I].add(t.increase),e[$D].add(t.decrease),e[IN].add(t.index),e[$M].add(t.memo),t.children.add(e),t=null,e}function Element_Render(e){let t=L();if("string"==typeof e||"number"==typeof e)return declareCounter(new Text(e));if("function"==typeof e){let n=new Text;return t.hooks.Effects.add(()=>{let t=e();n.nodeValue!==t.toString()&&(n.nodeValue=t)}),declareCounter(n)}if(e instanceof Node)return declareCounter(e);if(Array.isArray(e))return Render(e);let r;if("fragment"==e.tag)r=new DocumentFragment;else{if($Components.has(e.tag))return declareCounter($Components.render(e.tag,{props:e.props,slot:Render(e.children),children:e.children}));if("text"==e.tag)return r=new Text,"function"==typeof e.children[0]?t.hooks.Effects.add(function(){$CV(r,"nodeValue",e.children[0]().toString())}):r.nodeValue=e.children[0],declareCounter(r);declareCounter(r=document.createElement(e.tag))}return e.props&&Object.keys(e.props).forEach(n=>{if("function"==typeof e.props[n]){if(n.startsWith("on")){let l=n.toLowerCase().substring(2);t.eventlisteners.has(r)||t.eventlisteners.set(r,new Map),t.eventlisteners.get(r).set(l,function(){e.props[n].call(this)}),l=null}else if("use"==n||"sync"==n){function i(){e.props[n].call(r)}"use"==n?(i.call(r),i=null):t.hooks.Effects.add(i)}else{let s=elementProperties.includes(n)?$CV:$CA;function a(){s(r,n,e.props[n]().toString())}a.kill=()=>{s=null,a=null},t.hooks.Effects.add(a)}}else elementProperties.includes(n)?r[n]=e.props[n]:r.setAttribute(n,e.props[n])}),Array.isArray(e.children)?e.children.forEach(e=>{r.appendChild(Element_Render(e))}):e.children&&r.appendChild(Element_Render(e.children)),r}function Fragment_Render(e){return{tag:"fragment",props:void 0,children:e}}function Render(e,t=!1){let n=L()?L()._memo:null;newRender(t??n);let r="function"==typeof e?e():e,l;return Array.isArray(r)&&(r=Fragment_Render(r)),l=r instanceof Node?r:Element_Render(r),RenderContext.pop().page=l,l}function Memo(e){return Render(e,!0)}let o=new MutationObserver(e=>{e.forEach(e=>{"childList"==e.type&&(e.removedNodes.forEach(e=>{collect(e).forEach(e=>ID(e))}),e.addedNodes.forEach(e=>{collect(e).forEach(e=>ID(e,1))}))})});o.observe(document,{childList:!0,subtree:!0});export{html,Component,e as onConnect,t as onRemove,Elements,createComputed,createReducer,createState,untrack,watch,Watch,Render,Memo,Mount};